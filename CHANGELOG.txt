================================================================================
DMA BENCHMARK APPLICATION - CHANGELOG
================================================================================

================================================================================
VERSION: v8_vivado_v3 (2026-01-31)
================================================================================

CHANGES:
--------
1. [VIVADO] New build script: build_all_dma_v3.tcl
   - Fixed NoC bandwidth constraints (reduced from 5000 to 1000 MB/s)
   - LPD DMA uses internal CIPS NoC paths (removed M_AXI_LPD attempt)
   - Successfully builds and generates PDI/XSA

2. [VIVADO] AXI DMA buffer length increased
   - Changed c_sg_length_width from default 14-bit to 26-bit
   - Max transfer size: 64MB (was 16KB)

3. [VIVADO] AXI CDMA burst size reduced
   - Reduced C_M_AXI_MAX_BURST_LEN from 256 to 64
   - Better NoC compatibility

4. [SOFTWARE] Updated axi_dma_test.c
   - Updated comments to reflect 26-bit length (64MB max)
   - Increased default test sizes from 8KB to 64KB

VIVADO OUTPUT FILES (INCLUDED):
-------------------------------
- vivado_outputs/design_all_dma_v3.xsa (use with Vitis)
- vivado_outputs/design_all_dma_v3.pdi (for JTAG programming)
- vivado_outputs/build_all_dma_v3.tcl (build script)

NOTE ON LPD DMA:
----------------
LPD DMA (ADMA) accesses memory through internal CIPS NoC paths.
If ADMA still has issues accessing LPDDR4, use OCM (0xFFFC0000) for tests.

================================================================================
VERSION: v7_int_printing (2026-01-31)
================================================================================

CHANGES:
--------
1. [FIX] Float printing compatibility with xil_printf
   - Problem: xil_printf does not support %f format specifier
   - Solution: Changed all performance metrics from double to uint32_t

2. [CHANGE] TestResult_t structure (dma_benchmark.h)
   - throughput_mbps: double -> uint32_t (MB/s as whole number)
   - latency_us: double -> uint32_t
   - Added latency_ns for sub-microsecond precision
   - All statistics fields now uint32_t

3. [CHANGE] CALC_THROUGHPUT_MBPS macro
   - Now returns uint32_t using integer math
   - Formula: (bytes * 1000000) / (us * 1048576)

4. [UPDATE] All test files updated for integer printing
   - axi_dma_test.c, axi_cdma_test.c, axi_mcdma_test.c, lpd_dma_test.c
   - comparison_test.c - all double usage removed
   - Format strings changed from %.2f to %lu

5. [UPDATE] results_logger.c
   - format_throughput() now takes uint32_t
   - format_time() now takes uint32_t time_us and time_ns
   - All LOG_RESULT calls use integer format

6. [UPDATE] memory_utils.c
   - memory_cpu_memcpy_benchmark() returns uint32_t instead of double

================================================================================
VERSION: v6_lpd_dma_axi_error (2026-01-31)
================================================================================

CHANGES:
--------
1. [ANALYSIS] LPD DMA: Identified root cause - AXI Write Error
   - Log analysis showed: STATUS=0x03 (DONE_WITH_ERROR), ISR=0x600
   - ISR 0x600 = DMA_DONE (0x400) | AXI_WR_DATA (0x200)
   - Root cause: ADMA cannot write to LPDDR4 addresses!
   - ADMA in Versal needs NoC path to access LPDDR4

2. [FIX] LPD DMA: Updated interrupt bit definitions
   - File: src/drivers/lpd_dma_driver.h
   - Fixed ISR bit masks to match Xilinx xzdma_hw.h
   - Added XLPDDMA_STATUS_STATE_ERR (0x03) for done-with-error state
   - Corrected: AXI_WR_DATA=0x200, AXI_RD_DATA=0x100

3. [FIX] LPD DMA: Added proper error state detection
   - File: src/drivers/lpd_dma_driver.c
   - Detect STATUS=0x03 as error state (was being ignored)
   - Decode specific error bits (AXI_WR_DATA, AXI_RD_DATA, etc.)
   - Added helpful error message suggesting OCM instead of LPDDR4

KNOWN ISSUE:
------------
ADMA (LPD DMA) cannot access LPDDR4 memory directly. This is a Vivado
design issue - ADMA needs NoC connection to DDR. Current workaround:
use OCM (0xFFFC0000) for LPD DMA tests.

================================================================================
VERSION: v5_lpd_dma_debug (2026-01-31)
================================================================================

CHANGES:
--------
1. [FIX] LPD DMA: Still not transferring data after CTRL2 change
   - File: src/drivers/lpd_dma_driver.c
   - Problem: ZDMA transfer not starting despite CTRL2=1
   - Root cause analysis from logs: dst buffer still shows 0xDE (fill pattern)
   - Solution: Complete rewrite of transfer sequence:
     a) Added explicit channel disable before setup (CTRL2=0)
     b) Added TOTAL_BYTE register programming
     c) Changed descriptor WRD3 to 0 (simple mode, no flags)
     d) Added extensive debug logging (STATUS, ISR before/after)
     e) Added small delay after start to capture initial state

2. [DEBUG] LPD DMA: Enhanced wait_complete diagnostics
   - File: src/drivers/lpd_dma_driver.c
   - Added TOTAL_BYTE readout on completion and timeout
   - Shows detailed completion reason (ISR vs IDLE state)
   - Better error reporting with all relevant register values

================================================================================
VERSION: v4_timer_debug (2026-01-31)
================================================================================

CHANGES:
--------
1. [FIX] LPD DMA: Transfer not working
   - File: src/drivers/lpd_dma_driver.c
   - File: src/drivers/lpd_dma_driver.h
   - Problem: DMA transfer was not starting, destination buffer remained unchanged
   - Solution: Changed transfer trigger from CTRL1 to CTRL2 register
   - Added XLPDDMA_ZDMA_CH_CTRL2 (0x200) register definition
   - Write CTRL2=1 to start transfer instead of CTRL1=0

2. [FIX] RANDOM pattern verification failure
   - File: src/utils/data_patterns.c
   - Problem: Static variable declared twice in different switch branches
   - Solution: Moved rand_val variable outside switch statement

3. [FIX] CHECKERBOARD pattern verification failure
   - File: src/utils/data_patterns.c
   - Problem: Fill uses 0xAA55AA55 (little-endian: 0x55,0xAA,0x55,0xAA)
             but verify expected (i&1)?0x55:0xAA (0xAA,0x55,0xAA,0x55)
   - Solution: Changed verify to (i&1)?0xAA:0x55 to match fill pattern

4. [FIX] Unrealistic throughput values (111 GB/s)
   - File: src/utils/timer_utils.c
   - Problem: PMU cycle counter may not be enabled/accessible
   - Solution: Added timer calibration test at init
   - Now shows start/end/elapsed cycles for 1ms delay
   - Warns if measured cycles differ significantly from expected

================================================================================
VERSION: v3 (2026-01-31)
================================================================================

CHANGES:
--------
1. [FIX] AXI DMA: "Length exceeds max 16383" error
   - File: src/tests/axi_dma_test.c
   - Problem: Default test size 64KB exceeded 14-bit max (16383 bytes)
   - Solution: Changed default to 8KB, added clamp to AXI_DMA_MAX_TRANSFER_SIZE

2. [FIX] AXI CDMA: Crash when accessing BRAM/URAM
   - File: src/tests/axi_cdma_test.c
   - Problem: Memory matrix test tried to access regions with test_size=0
   - Solution: Skip regions where memory_get_max_size() returns 0

3. [FIX] LPD DMA: Added debug output for integrity test
   - File: src/tests/lpd_dma_test.c
   - Shows dst[0..7] bytes after transfer to diagnose issues

================================================================================
VERSION: v2 (2026-01-31)
================================================================================

CHANGES:
--------
1. [ADD] Debug logging throughout AXI DMA driver
   - File: src/drivers/axi_dma_driver.c
   - Added LOG_ALWAYS/LOG_DEBUG for initialization, transfer, wait functions
   - Shows register values, addresses, status codes

2. [FIX] Timer: Changed from custom PMU timer to usleep()
   - File: src/drivers/axi_dma_driver.c
   - Wait functions now use usleep() for reliable timing

================================================================================
VERSION: v1 (2026-01-30)
================================================================================

Initial release with:
- AXI DMA driver (SG mode)
- AXI CDMA driver (SG mode)
- AXI MCDMA driver (4 channels)
- LPD DMA driver (8 channels)
- Test modules for each DMA type
- Utility functions (timer, memory, cache, patterns, results logger)

================================================================================
